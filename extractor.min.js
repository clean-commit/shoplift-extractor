!function(){const e=(e,t=!1)=>{const r=document.createElement("div");r.style.position="fixed",r.style.top="10px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.background=t?"#f44336":"#6d28d9",r.style.color="white",r.style.padding="10px 20px",r.style.borderRadius="5px",r.style.zIndex="9999",r.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",r.textContent=e,document.body.appendChild(r),setTimeout((()=>{r.remove()}),t?5e3:3e3)},t=(e,t=5e3,r=200)=>new Promise(((o,n)=>{const c=Date.now(),i=()=>{const s=document.querySelectorAll(e);s.length>0?o(s):Date.now()-c>t?n(new Error(`Elements not found: ${e}`)):setTimeout(i,r)};i()})),r=e=>e?parseFloat(e.replace(/[$,€£%]/g,"")):0,o=(e,t)=>{const o=r(e),n=r(t);if(0===o)return n>0?"+100%":"0%";const c=(n-o)/o*100;return`${c>0?"+":""}${c.toFixed(1)}%`};(async(n=!1)=>{e("Extracting Shoplift test data...");try{const c=n?3e3:1e4;try{await t(".headline-bold",c),await t(".test-report-variant-card-stats",c)}catch(e){console.warn("Some page elements not found:",e.message)}await new Promise((e=>setTimeout(e,500)));[...[...document.querySelectorAll(".dropdown-item.d-flex.items-center.gap-8px.gap-8px")].filter((e=>e.innerText.toLowerCase().includes("all metrics")))].forEach((e=>e.click()));const i=(()=>{let e="",t="";try{const r=document.querySelectorAll("h5.headline-bold.mb-32px");if(e=r[0]?.textContent.trim(),!e){const t=window.location.href.match(/store\/([^\/]+)/);t&&t[1]&&(e=decodeURIComponent(t[1]))}const o=document.querySelectorAll("h2");for(const e of o){const r=e.textContent.trim();if(r&&!r.includes("Performance overview")&&!r.includes("Traffic overview")&&!r.includes("Device performance")){t=r;break}}}catch(e){console.error("Error extracting test info:",e)}return{store_name:e||"Unknown Store",test_name:t||"Unknown Test"}})(),s=(()=>{try{const e=document.querySelectorAll("div.d-flex.rounded-4px.items-center.p-16px.mt-8px div");if(0===e.length)return"Unknown Goal";const t={};for(const r of e){const e=r.querySelectorAll("label");t[e[0].textContent.trim().toLowerCase().replace(":","")]=e[1].textContent.trim()}return t}catch(e){return console.error("Error extracting test type:",e),"Unknown Goal"}})(),a=(()=>{try{const e=document.querySelectorAll(".test-report-overview-row > div"),t={};for(const r of e){const e=r.querySelector("label"),o=r.querySelector("div");t[e.textContent.trim().toLowerCase().replace(".","").replace(/\s+/g,"_")]=o.textContent.trim().replace(/\s+/g," ")}return t}catch(e){console.error("Error extracting test overview:",e)}return{}})(),l=(()=>{const e={};try{document.querySelectorAll(".performance-table").forEach((t=>{const r=Array.from(t.querySelectorAll("thead th")).map((e=>e.textContent.trim()));r.includes("Device")&&t.querySelectorAll("tbody").forEach((t=>{const n=t.querySelector("th span");if(!n)return;const c=n.textContent.trim().toLowerCase().replace(/all devices/i,"all_devices").replace(/\s+/g,"_");e[c]={};const i={};let s,a,l=["visitors","clicks",["ctr","clickthrough rate"],"cart adds",["acr","add to cart rate"],"bounce rate","orders",["cvr","conversion rate"],"revenue",["aov","average order value"],["rpv","revenue per visitor"]];r.forEach(((e,t)=>{const r=e.toLowerCase();l.forEach(((e,o)=>{if(Array.isArray(e)){if(e.some((e=>r.includes(e))))return l.splice(o,1),void(i[e[0]]=t)}else if(r.includes(e))return l.splice(o,1),void(i[e]=t)}))})),t.querySelectorAll("tr").forEach((e=>{const t=e.querySelector("th:nth-child(2)")||e.querySelector("th");if(!t)return;const r=t.textContent.trim();r.includes("Variant")?s=e:r.includes("Original")&&(a=e)})),Object.keys(i).forEach((t=>{const r=i[t];if(void 0!==r){if(e[c][t]={original:"0",variant:"0",change:"0%"},a){const o=a.querySelectorAll("th, td")[r];if(o){const r=o.textContent.trim();e[c][t].original=r.split(" ")[0]}}if(s){const n=s.querySelectorAll("th, td")[r];if(n){const r=n.textContent.trim();e[c][t].variant=r.split(" ")[0];const i=n.querySelector(".label-tint");if(i)e[c][t].change=i.textContent.trim();else{const r=e[c][t].original,n=e[c][t].variant;r&&n&&(e[c][t].change=o(r,n))}}}}}))}))}))}catch(e){console.error("Error extracting metrics:",e)}return e})(),d=(e=>{const t=r(e.desktop.visitors.original)+r(e.desktop.visitors.variant),o=r(e.mobile.visitors.original)+r(e.mobile.visitors.variant);return{total:t+o,desktop:t,mobile:o}})(l),u={store:i.store_name,test:i.test_name,configuration:s,overview:a,traffic:d,metrics:l,extractedAt:(new Date).toISOString()},m=JSON.stringify(u,null,2);if(document.querySelector("#shoplift-test-data"))return document.querySelector("#shoplift-test-data").textContent=JSON.stringify(u,null,4),u;const f=new Blob([m],{type:"application/json"}),p=URL.createObjectURL(f),y=document.createElement("a");return y.href=p,y.download=`shoplift-${i.test.replace(/[^a-z0-9]/gi,"-").toLowerCase()}-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),e("Test data extracted successfully!"),u}catch(t){throw console.error("Error extracting test data:",t),e(`Error extracting test data: ${t.message}`,!0),t}})()}();